<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Dashboard</title>

   <!-- font awesome cdn link  -->

   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css">

   <!-- custom css file link  -->

   <link rel="stylesheet" href="/style/profile v2.css">
   <!-- Chart.js removed -->
   <style>
      .stats-container {
         display: flex;
         flex-wrap: wrap;
         justify-content: space-around;
         margin-top: 15px;
      }
      .stat-item {
         text-align: center;
         padding: 10px;
         flex: 1 0 20%;
         min-width: 100px;
      }
      .stat-item i {
         font-size: 24px;
         color: #4CAF50;
         margin-bottom: 5px;
      }
      .stat-item span {
         display: block;
         font-size: 24px;
         font-weight: bold;
         margin: 5px 0;
      }
      .stat-item p {
         margin: 0;
         font-size: 14px;
         color: #666;
      }
      .stats-box {
         background-color: #f9f9f9;
      }
      /* Skill Gap Analysis Styles */
      .skill-gap-row {
         width: 100%;
         margin-bottom: 30px;
         position: relative;
      }

      .skill-gap-row::before {
         content: '';
         position: absolute;
         top: -10px;
         left: 0;
         right: 0;
         height: 3px;
         background: linear-gradient(to right, #4CAF50, #2196F3, #FF9800);
         border-radius: 3px;
      }

      .skill-gap-box {
         margin-top: 20px;
         width: 100%;
         background-color: #fff;
         border-radius: 10px;
         box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
         padding: 25px;
         border-top: 5px solid #4CAF50;
         transition: all 0.3s ease;
      }

      .skill-gap-box:hover {
         transform: translateY(-5px);
         box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      }

      .skill-gap-box .flex {
         border-bottom: 1px solid #eee;
         padding-bottom: 15px;
         margin-bottom: 20px;
      }

      .skill-gap-box .flex i {
         font-size: 24px;
         color: #4CAF50;
         margin-right: 15px;
      }

      .skill-gap-box .flex span {
         font-size: 20px;
         font-weight: bold;
         color: #333;
      }

      .skill-gap-box .flex p {
         margin-top: 5px;
         color: #666;
      }

      .career-goal-section {
         margin: 20px 0;
         padding: 20px;
         background-color: #f5f5f5;
         border-radius: 10px;
         border-left: 4px solid #2196F3;
         box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
         position: relative;
         overflow: hidden;
      }

      .career-goal-section::after {
         content: '';
         position: absolute;
         top: 0;
         right: 0;
         width: 150px;
         height: 100%;
         background: linear-gradient(135deg, transparent 0%, rgba(33, 150, 243, 0.1) 100%);
         z-index: 1;
      }

      .career-goal-section h3 {
         margin-top: 0;
         margin-bottom: 15px;
         color: #333;
      }

      #career-goal-display {
         color: #2196F3;
         font-weight: bold;
      }

      .overall-progress {
         display: flex;
         align-items: center;
         margin-top: 10px;
      }

      .progress-label {
         width: 150px;
         font-weight: bold;
         color: #555;
      }

      .progress-bar-container {
         display: flex;
         align-items: center;
         flex-grow: 1;
      }

      .progress-bar-outer {
         height: 20px;
         background-color: #e0e0e0;
         border-radius: 10px;
         flex-grow: 1;
         margin-right: 15px;
         overflow: hidden;
         box-shadow: inset 0 2px 3px rgba(0,0,0,0.1);
         position: relative;
      }

      .progress-bar-outer::before {
         content: '';
         position: absolute;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background: linear-gradient(to right, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.1) 100%);
         z-index: 2;
      }

      .progress-bar-inner {
         height: 100%;
         width: 0%;
         background: linear-gradient(to right, #4CAF50, #8BC34A);
         border-radius: 10px;
         transition: width 1.2s cubic-bezier(0.22, 0.61, 0.36, 1);
         position: relative;
      }

      .progress-bar-inner::after {
         content: '';
         position: absolute;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background: linear-gradient(45deg,
                     rgba(255,255,255,0.15) 25%,
                     transparent 25%,
                     transparent 50%,
                     rgba(255,255,255,0.15) 50%,
                     rgba(255,255,255,0.15) 75%,
                     transparent 75%,
                     transparent);
         background-size: 20px 20px;
         animation: move-stripes 2s linear infinite;
         border-radius: 10px;
      }

      @keyframes move-stripes {
         0% { background-position: 0 0; }
         100% { background-position: 40px 0; }
      }

      .progress-text {
         font-weight: bold;
         color: #4CAF50;
         width: 50px;
         text-align: right;
      }

      .skill-gap-container {
         margin: 25px 0;
         padding: 20px;
         background-color: #fff;
         border-radius: 10px;
         box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
      }

      .skill-gap-container h3 {
         margin-top: 0;
         margin-bottom: 20px;
         color: #333;
         font-size: 18px;
         position: relative;
         padding-left: 15px;
      }

      .skill-gap-container h3::before {
         content: '';
         position: absolute;
         left: 0;
         top: 0;
         bottom: 0;
         width: 4px;
         background-color: #4CAF50;
         border-radius: 4px;
      }

      .skill-gap-list {
         display: flex;
         flex-direction: column;
         gap: 15px;
      }

      .skill-gap-item {
         display: flex;
         flex-direction: column;
         padding: 12px 15px;
         background-color: #f9f9f9;
         border-radius: 8px;
         margin-bottom: 12px;
         transition: all 0.3s ease;
         border-left: 3px solid transparent;
      }

      .skill-gap-item:hover {
         background-color: #f5f5f5;
         transform: translateX(5px);
         box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      }

      .skill-gap-item:last-child {
         margin-bottom: 0;
      }

      /* Color coding for skill levels */
      .skill-gap-item.beginner {
         border-left-color: #FFC107;
      }

      .skill-gap-item.intermediate {
         border-left-color: #2196F3;
      }

      .skill-gap-item.advanced {
         border-left-color: #4CAF50;
      }

      .skill-gap-item.missing {
         border-left-color: #F44336;
      }

      .skill-header {
         display: flex;
         justify-content: space-between;
         margin-bottom: 5px;
      }

      .skill-name {
         font-weight: bold;
         color: #333;
      }

      .skill-level {
         color: #666;
      }

      .skill-progress-container {
         display: flex;
         align-items: center;
      }

      .skill-progress-bar {
         height: 15px;
         background-color: #e0e0e0;
         border-radius: 7.5px;
         flex-grow: 1;
         margin-right: 10px;
         overflow: hidden;
         position: relative;
      }

      .skill-progress-fill {
         height: 100%;
         background-color: #4CAF50;
         border-radius: 7.5px;
         transition: width 1s ease-in-out;
      }

      .skill-progress-fill.beginner {
         background-color: #FFC107; /* Yellow */
      }

      .skill-progress-fill.intermediate {
         background-color: #2196F3; /* Blue */
      }

      .skill-progress-fill.advanced {
         background-color: #4CAF50; /* Green */
      }

      .skill-progress-fill.missing {
         background-color: #F44336; /* Red */
         width: 100%;
         opacity: 0.3;
      }

      .skill-progress-text {
         font-weight: bold;
         width: 40px;
         text-align: right;
      }

      .skill-recommendations {
         margin-top: 25px;
         padding: 20px;
         background-color: #fff8e1;
         border-radius: 10px;
         border-left: 4px solid #FF9800;
         box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
         position: relative;
         overflow: hidden;
      }

      .skill-recommendations::before {
         content: '\f0eb';
         font-family: 'Font Awesome 5 Free';
         font-weight: 900;
         position: absolute;
         right: -15px;
         top: -15px;
         font-size: 100px;
         color: rgba(255, 152, 0, 0.05);
         z-index: 0;
      }

      .skill-recommendations h3 {
         margin-top: 0;
         margin-bottom: 10px;
         color: #333;
      }

      .skill-recommendations ul {
         margin: 0;
         padding-left: 20px;
      }

      .skill-recommendations li {
         margin-bottom: 8px;
      }

      .skill-recommendations a {
         color: #2196F3;
         text-decoration: none;
         font-weight: bold;
      }

      .skill-recommendations a:hover {
         text-decoration: underline;
      }

      .loading-message {
         text-align: center;
         padding: 20px;
         color: #666;
         font-style: italic;
      }
   </style>
</head>
<body>

<header class="header">

   <section class="flex">

      <a href="/" class="logo">Career Guidance</a>

      <div class="icons">
         <div id="menu-btn" class="fas fa-bars"></div>
         <div id="user-btn" class="fas fa-user"></div>
         <div id="toggle-btn" class="fas fa-sun"></div>
      </div>

      <div class="profile">
         <img
            src="/api/profile/profile-pic"
            class="image"
            alt="Profile Picture"
            onerror="this.onerror=null; this.src='/images/Screenshot%202024-11-21%20144815.png';"
         >
         <h1 th:text="${name}"></h1>
         <p class="role">User</p>
         <a href="/dashboard" class="btn">view profile</a>
         <div class="flex-btn">
            <a href="/logout" class="option-btn">logout</a>
         </div>
      </div>

   </section>

</header>

<div class="side-bar">

   <div id="close-btn">
      <i class="fas fa-times"></i>
   </div>

   <div class="profile">
      <img
            src="/api/profile/profile-pic"
            class="image"
            alt="Profile Picture"
            onerror="this.onerror=null; this.src='/images/Screenshot%202024-11-21%20144815.png';"
      >
      <h1 th:text="${name}"></h1>
      <p class="role">User</p>
      <a href="/dashboard" class="btn">view profile</a>
   </div>

   <nav class="navbar">
      <a href="/dashboard"><i class="fas fa-home"></i><span>Home</span></a>
      <a href="/skills" th:if="${session.userType == 'student'}"><i class="fas fa-graduation-cap"></i><span>Skill Gap Analysis</span></a>
      <a href="/courses"><i class="fas fa-graduation-cap"></i><span>Courses</span></a>
      <a href="/jobrecommendation"><i class="fas fa-graduation-cap"></i><span>Job Recommendation</span></a>
      <a href="/feedback" th:if="${session.userType == 'student'}"><i class="fas fa-headset"></i><span>Feedback</span></a>

    </nav>

</div>

<section class="user-profile">

   <h1 class="heading">Your Profile</h1>

   <!-- Skill Gap Analysis - Full Width Row -->
   <div class="skill-gap-row">
      <div class="box skill-gap-box">
         <div class="flex">
            <i class="fas fa-chart-line"></i>
            <div>
               <span>Skill Gap Analysis</span>
               <p>Your progress towards career readiness</p>
            </div>
         </div>

         <div class="career-goal-section">
            <h3>Career Goal: <span id="career-goal-display">Loading...</span></h3>
            <div class="overall-progress">
               <div class="progress-label">Overall Readiness:</div>
               <div class="progress-bar-container">
                  <div id="overall-progress-bar" class="progress-bar-outer">
                     <div id="overall-progress-fill" class="progress-bar-inner"></div>
                  </div>
                  <div id="overall-progress-text" class="progress-text">0%</div>
               </div>
            </div>
         </div>

         <div class="skill-gap-container">
            <h3>Required Skills Progress</h3>
            <div id="skill-gap-list" class="skill-gap-list">
               <!-- Skill gap bars will be added here dynamically -->
               <div class="loading-message">Loading skill data...</div>
            </div>
         </div>

         <div class="skill-recommendations">
            <h3>Recommendations</h3>
            <ul id="skill-recommendations-list">
               <li>Visit the <a href="/courses">Courses</a> page to find learning resources for missing skills</li>
               <li>Update your skills on the <a href="/skills">Skills</a> page as you learn new ones</li>
            </ul>
         </div>
      </div>
   </div>

   <!-- User Profile and Other Information -->
   <div class="info">

      <div class="user">
         <img
            src="/api/profile/profile-pic"
            class="image"
            alt="Profile Picture"
            onerror="this.onerror=null; this.src='/images/Screenshot%202024-11-21%20144815.png';"
         >
        <h1>Welcome, <span th:text="${name}"></span>!</h1>
        <p>Email: <span th:text="${email}"></span></p>
         <a href="/update" class="inline-btn">update profile</a>
      </div>


      <div class="box-container">
         <!-- Statistics Section -->
         <div class="box stats-box">
            <div class="flex">
               <i class="fas fa-chart-line"></i>
               <div>
                  <span>Your Statistics</span>
               </div>
            </div>
            <div class="stats-container">
               <div class="stat-item">
                  <i class="fas fa-book"></i>
                  <span id="matched-courses-count">0</span>
                  <p>Courses Matched</p>
               </div>
               <div class="stat-item">
                  <i class="fas fa-briefcase"></i>
                  <span id="matched-jobs-count">0</span>
                  <p>Jobs Matched</p>
               </div>
               <div class="stat-item">
                  <i class="fas fa-graduation-cap"></i>
                  <span id="skills-count">0</span>
                  <p>Skills</p>
               </div>
               <div class="stat-item">
                  <i class="fas fa-chart-pie"></i>
                  <span id="skill-completion">0%</span>
                  <p>Career Readiness</p>
               </div>
            </div>
         </div>

         <div class="box">
            <div class="flex">
               <i class="fas fa-bookmark"></i>
               <div>
                  <span>Skills</span>
               </div>

            </div>
            <ul id="skills-list" style="font-weight: bold;font-size: medium;float: right;">
            </ul>
         </div>


         <div class="box">
            <div class="flex">
               <i class="fas fa-bookmark"></i>
               <div>
                  <span>Interests</span>
               </div>

            </div>
            <ul id="interests" style="font-weight: bold;font-size: medium;float: right;">
            </ul>
         </div>


         <div class="box">
            <div class="flex">
               <i class="fas fa-bookmark"></i>
               <div>
                  <span>Certifications</span>
               </div>

            </div>
            <ul id="certifications" style="font-weight: bold;font-size: medium;float: right;">
            </ul>
         </div>
         <div class="box">
            <div class="flex">
               <i class="fas fa-bookmark"></i>

               <div>
                  <span>Acheivements</span>
               </div>

            </div>
            <ul id="achievements" style="font-weight: bold;font-size: medium;float: right;">
            </ul>
         </div>
         <!-- Skill Gap Analysis moved to top section -->
   </div>


</section>


<footer class="footer">

   &copy; copyright @ 2024 by | All Rights Reserved!

</footer>

<!-- custom js file link  -->
<script src="/script/profile.js"></script>
<script>
   // Test chart function removed

   // Main function to load all data when the page loads
   document.addEventListener('DOMContentLoaded', async function() {
      console.log('DOM content loaded');

      // Load all data
      await loadSkills();
      await loadInterests();
      await loadCertifications();
      await loadAchievements();
      await loadStatistics();
      await loadSkillGapAnalysis();
   });

   // Load user skills
   async function loadSkills() {
      try {
         const response = await fetch('/api/profiles/skills');
         if (response.ok) {
            const skills = await response.json();
            const skillsList = document.getElementById('skills-list');
            skillsList.innerHTML = ''; // Clear existing content

            skills.forEach(skill => {
               const li = document.createElement('li');
               li.textContent = skill; // Display skill and level
               skillsList.appendChild(li);
            });

            // Update skills count in statistics
            document.getElementById('skills-count').textContent = skills.length;
         } else {
            console.error('Failed to fetch skills', response.statusText);
         }
      } catch (error) {
         console.error('Error:', error);
      }
   }

   // Load user interests
   async function loadInterests() {
      try {
         const response = await fetch('/api/profile/interests');
         if (response.ok) {
            const interests = await response.json();
            const interestsList = document.getElementById('interests');
            interestsList.innerHTML = ''; // Clear existing content

            interests.forEach(interest => {
               const li = document.createElement('li');
               li.textContent = interest.trim(); // Trim to remove extra spaces
               interestsList.appendChild(li);
            });
         } else {
            console.error('Failed to fetch interests:', response.statusText);
         }
      } catch (error) {
         console.error('Error fetching interests:', error);
      }
   }

   // Load user certifications
   async function loadCertifications() {
      try {
         const response = await fetch('/api/profile/certifications');
         if (response.ok) {
            const certifications = await response.json();
            const certificationsList = document.getElementById('certifications');
            certificationsList.innerHTML = ''; // Clear existing content

            certifications.forEach(certification => {
               const li = document.createElement('li');
               li.textContent = certification.trim(); // Trim to remove extra spaces
               certificationsList.appendChild(li);
            });
         } else {
            console.error('Failed to fetch certifications:', response.statusText);
         }
      } catch (error) {
         console.error('Error fetching certifications:', error);
      }
   }

   // Load user achievements
   async function loadAchievements() {
      try {
         const response = await fetch('/api/profile/achievements');
         if (response.ok) {
            const achievements = await response.json();
            const achievementsList = document.getElementById('achievements');
            achievementsList.innerHTML = ''; // Clear existing content

            achievements.forEach(achievement => {
               const li = document.createElement('li');
               li.textContent = achievement.trim(); // Trim to remove extra spaces
               achievementsList.appendChild(li);
            });
         } else {
            console.error('Failed to fetch achievements:', response.statusText);
         }
      } catch (error) {
         console.error('Error fetching achievements:', error);
      }
   }

   // Load statistics
   async function loadStatistics() {
      try {
         // Fetch matched courses count using the recommend-courses API
         const coursesResponse = await fetch('/api/recommend-courses');
         if (coursesResponse.ok) {
            const courses = await coursesResponse.json();
            document.getElementById('matched-courses-count').textContent = courses.length;
         }

         // Fetch matched jobs count using the matching-jobs API
         const jobsResponse = await fetch('/api/matching-jobs');
         if (jobsResponse.ok) {
            const jobs = await jobsResponse.json();
            document.getElementById('matched-jobs-count').textContent = jobs.length;
         }

         // Calculate career readiness based on skill levels
         // Beginner: 5%, Intermediate: 8%, Advanced: 10%
         try {
            const skillsResponse = await fetch('/api/profiles/skills');
            if (skillsResponse.ok) {
               const skills = await skillsResponse.json();
               if (skills.length > 0) {
                  let totalReadiness = 0;

                  skills.forEach(skillWithLevel => {
                     // Parse the skill level from format "skill (level)"
                     const levelMatch = skillWithLevel.match(/\(([^)]+)\)/);
                     if (levelMatch && levelMatch[1]) {
                        const level = levelMatch[1].trim();

                        // Add readiness percentage based on skill level
                        if (level === 'Beginner') {
                           totalReadiness += 5;
                        } else if (level === 'Intermediate') {
                           totalReadiness += 8;
                        } else if (level === 'Advanced') {
                           totalReadiness += 10;
                        }
                     }
                  });

                  // Cap readiness at 100%
                  const readinessPercentage = Math.min(totalReadiness, 100);
                  document.getElementById('skill-completion').textContent = readinessPercentage + '%';
               } else {
                  document.getElementById('skill-completion').textContent = '0%';
               }
            }
         } catch (error) {
            console.error('Error calculating career readiness:', error);
            document.getElementById('skill-completion').textContent = '0%';
         }
      } catch (error) {
         console.error('Error fetching statistics:', error);
      }
   }

   // Load skill gap analysis data
   async function loadSkillGapAnalysis() {
      try {
         // Fetch user profile to get career goal
         const profileResponse = await fetch('/api/profiles/user-profile');
         if (!profileResponse.ok) {
            console.error('Failed to fetch user profile');
            document.getElementById('career-goal-display').textContent = 'Not specified';
            return;
         }

         const userProfile = await profileResponse.json();
         const careerGoal = userProfile.careerGoal || 'Not specified';
         document.getElementById('career-goal-display').textContent = careerGoal;

         // Fetch user skills
         const skillsResponse = await fetch('/api/profiles/skills');
         if (!skillsResponse.ok) {
            console.error('Failed to fetch user skills');
            return;
         }

         const skills = await skillsResponse.json();

         // Parse user skills and levels
         const userSkills = skills.map(skillWithLevel => {
            const parts = skillWithLevel.split(' (');
            const skillName = parts[0].trim().toLowerCase();
            const level = parts.length > 1 ? parts[1].replace(')', '').trim() : 'Unknown';
            return { skill: skillName, level };
         });

         // Fetch job skills mapping directly from the static JSON file
         const jobSkillsResponse = await fetch('/data/job-skills-mapping.json');
         let jobSkillsMapping;

         if (!jobSkillsResponse.ok) {
            console.error('Failed to fetch job skills mapping from static file');
            document.getElementById('skill-gap-list').innerHTML =
               '<div class="error-message">Failed to load job skills data. Please try again later.</div>';
            return;
         }

         try {
            const responseText = await jobSkillsResponse.text();
            jobSkillsMapping = JSON.parse(responseText);
            console.log('Successfully loaded job skills mapping from static file:', jobSkillsMapping);
         } catch (error) {
            console.error('Error parsing job skills mapping:', error);
            document.getElementById('skill-gap-list').innerHTML =
               '<div class="error-message">Failed to parse job skills data. Please try again later.</div>';
            return;
         }

         // Find matching job for career goal
         const normalizedCareerGoal = careerGoal.toLowerCase().trim();
         let targetJob = jobSkillsMapping.jobSkillsMapping.find(job =>
            job.jobTitle.toLowerCase().includes(normalizedCareerGoal) ||
            normalizedCareerGoal.includes(job.jobTitle.toLowerCase())
         );

         // If no matching job found, use the first job from the JSON file
         if (!targetJob) {
            console.log('No exact match found for career goal:', careerGoal);

            // Try to find a job with similar title
            const similarJobs = jobSkillsMapping.jobSkillsMapping.filter(job => {
               const jobTitle = job.jobTitle.toLowerCase();
               return jobTitle.includes('developer') || jobTitle.includes('engineer') ||
                      jobTitle.includes(normalizedCareerGoal) || normalizedCareerGoal.includes(jobTitle);
            });

            if (similarJobs.length > 0) {
               console.log('Found similar jobs:', similarJobs.map(job => job.jobTitle));
               targetJob = similarJobs[0];
               console.log('Using similar job:', targetJob.jobTitle);
            } else {
               // If no similar job found, use the first job from the JSON file
               console.log('No similar jobs found, using the first job from the JSON file');
               targetJob = jobSkillsMapping.jobSkillsMapping[0]; // Full Stack Developer
               console.log('Using default job:', targetJob.jobTitle);
            }
         }

         // Get required skills and user's skill levels
         const requiredSkills = targetJob.requiredSkills.map(skill => skill.toLowerCase());
         const userSkillMap = {};
         userSkills.forEach(skill => {
            userSkillMap[skill.skill] = skill.level;
         });

         // Calculate skill levels and overall progress
         const skillGapList = document.getElementById('skill-gap-list');
         skillGapList.innerHTML = '';

         let totalProgress = 0;
         const skillProgressData = [];

         requiredSkills.forEach(skill => {
            const userLevel = userSkillMap[skill];
            let progress = 0;
            let levelClass = 'missing';

            if (userLevel) {
               if (userLevel === 'Beginner') {
                  progress = 33;
                  levelClass = 'beginner';
                  totalProgress += 5; // 5% for beginner skills
               } else if (userLevel === 'Intermediate') {
                  progress = 66;
                  levelClass = 'intermediate';
                  totalProgress += 8; // 8% for intermediate skills
               } else if (userLevel === 'Advanced') {
                  progress = 100;
                  levelClass = 'advanced';
                  totalProgress += 10; // 10% for advanced skills
               }
            }

            skillProgressData.push({ skill, userLevel, progress, levelClass });
         });

         // Sort skills: first show skills the user has, then missing skills
         skillProgressData.sort((a, b) => {
            if (a.userLevel && !b.userLevel) return -1;
            if (!a.userLevel && b.userLevel) return 1;
            if (a.userLevel && b.userLevel) {
               // Sort by progress (highest first)
               return b.progress - a.progress;
            }
            return a.skill.localeCompare(b.skill);
         });

         // Create skill gap items
         skillProgressData.forEach(data => {
            const skillItem = document.createElement('div');
            skillItem.className = `skill-gap-item ${data.levelClass}`;

            const skillHeader = document.createElement('div');
            skillHeader.className = 'skill-header';

            const skillName = document.createElement('div');
            skillName.className = 'skill-name';
            skillName.textContent = data.skill.charAt(0).toUpperCase() + data.skill.slice(1);

            const skillLevel = document.createElement('div');
            skillLevel.className = 'skill-level';
            skillLevel.textContent = data.userLevel || 'Not acquired';

            skillHeader.appendChild(skillName);
            skillHeader.appendChild(skillLevel);

            const progressContainer = document.createElement('div');
            progressContainer.className = 'skill-progress-container';

            const progressBar = document.createElement('div');
            progressBar.className = 'skill-progress-bar';

            const progressFill = document.createElement('div');
            progressFill.className = `skill-progress-fill ${data.levelClass}`;
            progressFill.style.width = '0%'; // Start at 0 for animation

            const progressText = document.createElement('div');
            progressText.className = 'skill-progress-text';
            progressText.textContent = data.progress + '%';

            progressBar.appendChild(progressFill);
            progressContainer.appendChild(progressBar);
            progressContainer.appendChild(progressText);

            skillItem.appendChild(skillHeader);
            skillItem.appendChild(progressContainer);

            skillGapList.appendChild(skillItem);

            // Animate progress bars
            setTimeout(() => {
               progressFill.style.width = data.progress + '%';
            }, 100);
         });

         // Update overall progress
         const overallProgress = Math.min(totalProgress, 100);
         const overallProgressFill = document.getElementById('overall-progress-fill');
         const overallProgressText = document.getElementById('overall-progress-text');

         overallProgressText.textContent = overallProgress + '%';
         setTimeout(() => {
            overallProgressFill.style.width = overallProgress + '%';
         }, 100);

         // Update recommendations based on skill gaps
         const recommendationsList = document.getElementById('skill-recommendations-list');
         const missingSkills = skillProgressData.filter(data => !data.userLevel);

         // Clear existing dynamic recommendations
         const existingRecommendations = recommendationsList.querySelectorAll('li.dynamic-recommendation');
         existingRecommendations.forEach(item => item.remove());

         // Add job title information
         const jobInfoItem = document.createElement('li');
         jobInfoItem.className = 'dynamic-recommendation';
         jobInfoItem.innerHTML = `Based on skills required for <strong>${targetJob.jobTitle}</strong>`;
         recommendationsList.prepend(jobInfoItem);

         if (missingSkills.length > 0) {
            const missingSkillsText = missingSkills.map(data =>
               data.skill.charAt(0).toUpperCase() + data.skill.slice(1)
            ).join(', ');

            const recommendationItem = document.createElement('li');
            recommendationItem.className = 'dynamic-recommendation';
            recommendationItem.innerHTML = `Focus on learning these missing skills: <strong>${missingSkillsText}</strong>`;
            recommendationsList.prepend(recommendationItem);
         } else {
            const recommendationItem = document.createElement('li');
            recommendationItem.className = 'dynamic-recommendation';
            recommendationItem.innerHTML = '<strong>Great job!</strong> You have all the required skills for this job role. Consider advancing your skill levels further.';
            recommendationsList.prepend(recommendationItem);
         }

      } catch (error) {
         console.error('Error loading skill gap analysis:', error);
         document.getElementById('skill-gap-list').innerHTML =
            '<div class="error-message">Failed to load skill gap analysis. Please try again later.</div>';
      }
   }
</script>

</body>
</html>